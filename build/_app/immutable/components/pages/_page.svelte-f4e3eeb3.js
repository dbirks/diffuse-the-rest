import{S as K,i as $,s as G,k as x,a as A,q as Q,H as W,l as j,m as D,h as c,c as B,r as X,n as o,I as O,p as R,F as h,b as U,J as V,K as z,A as H,L as Y,o as Z,M as ee}from"../../chunks/index-3def1fb1.js";const{document:F}=ee;function te(b){let m,d,g,i,M,f,n,u,p,S,s,l,E,y,N,q,r,e,w;return{c(){m=x("link"),d=x("script"),i=x("script"),f=A(),n=x("div"),u=x("div"),p=x("div"),S=A(),s=x("div"),l=x("input"),E=A(),y=x("button"),N=Q("diffuse the f rest"),this.h()},l(a){const t=W('[data-svelte="svelte-18yikln"]',F.head);m=j(t,"LINK",{href:!0,rel:!0}),d=j(t,"SCRIPT",{src:!0});var v=D(d);v.forEach(c),i=j(t,"SCRIPT",{src:!0});var _=D(i);_.forEach(c),t.forEach(c),f=B(a),n=j(a,"DIV",{class:!0});var T=D(n);u=j(T,"DIV",{class:!0});var I=D(u);p=j(I,"DIV",{id:!0,style:!0}),D(p).forEach(c),S=B(I),s=j(I,"DIV",{class:!0});var C=D(s);l=j(C,"INPUT",{type:!0,class:!0,placeholder:!0}),E=B(C),y=j(C,"BUTTON",{class:!0});var k=D(y);N=X(k,"diffuse the f rest"),k.forEach(c),C.forEach(c),I.forEach(c),T.forEach(c),this.h()},h(){o(m,"href","https://cdnjs.cloudflare.com/ajax/libs/drawingboard.js/0.4.2/drawingboard.css"),o(m,"rel","stylesheet"),O(d.src,g="https://code.jquery.com/jquery-1.12.4.min.js")||o(d,"src",g),O(i.src,M="https://cdnjs.cloudflare.com/ajax/libs/drawingboard.js/0.4.2/drawingboard.min.js")||o(i,"src",M),o(p,"id","board-container"),R(p,"width","512px"),R(p,"height","545px"),o(l,"type","text"),o(l,"class","border-2 "),o(l,"placeholder","Add prompt"),o(y,"class","bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4"),o(s,"class",q="flex gap-x-2 mt-4 items-center justify-center "+(b[1]?"animate-pulse":"")),o(u,"class",r=b[1]?"pointer-events-none":""),o(n,"class","flex flex-wrap gap-x-8 justify-center mt-16")},m(a,t){h(F.head,m),h(F.head,d),h(F.head,i),U(a,f,t),U(a,n,t),h(n,u),h(u,p),h(u,S),h(u,s),h(s,l),V(l,b[0]),h(s,E),h(s,y),h(y,N),e||(w=[z(l,"input",b[3]),z(y,"click",b[2])],e=!0)},p(a,[t]){t&1&&l.value!==a[0]&&V(l,a[0]),t&2&&q!==(q="flex gap-x-2 mt-4 items-center justify-center "+(a[1]?"animate-pulse":""))&&o(s,"class",q),t&2&&r!==(r=a[1]?"pointer-events-none":"")&&o(u,"class",r)},i:H,o:H,d(a){c(m),c(d),c(i),a&&c(f),a&&c(n),e=!1,Y(w)}}}const L=500,J=3e3,P=512;async function ae(b){const m=b.toDataURL("png"),g=await(await fetch(m)).blob();return new File([g],"canvas shot.png",{type:"image/png"})}function ne(b,m,d){let g="",i=!1,M=!1,f,n,u,p,S,s;async function l(){if(!n)return;const r=n.createImageData(f.width,f.height),e=r.data;for(let t=0,v=e.length;t<v;t+=4)e[t]=40*Math.random()*7,e[t+1]=40*Math.random()*7,e[t+2]=40*Math.random()*7,e[t+3]=255;const w=await createImageBitmap(r),a=performance.now()-u;n.globalAlpha=Math.min(a,J)/J,n.drawImage(w,0,0,P,P),i&&window.requestAnimationFrame(l)}function E(r){if(!n)return;const e=performance.now()-p;n.globalAlpha=Math.min(e,L)/L,n.drawImage(r,0,0,P,P),e<L&&window.requestAnimationFrame(()=>E(r))}async function y(){if(!g)return alert("Please add prompt");if(!f||!n)return;d(1,i=!0),u=performance.now(),l();const r=await ae(f),e=new FormData;e.append("prompt",g),e.append("image",r);const w=await fetch("https://sdb.pcuenca.net/i2i",{method:"POST",body:e});try{const a=JSON.parse(await w.text()),{images:t}=a,v=await Promise.all(t.map(async T=>{const I=new Image;return I.src=`data:image/png;base64, ${T}`,await new Promise((C,k)=>{I.onload=()=>C(I)}),I}));d(1,i=!1),s&&clearInterval(s);let _=0;p=performance.now(),E(v[_%v.length]),S=()=>{s&&clearInterval(s),p=performance.now(),_=_+1,E(v[_%v.length])},s=setInterval(()=>{_=_+1,p=performance.now(),E(v[_%v.length])},2500),M||N()}catch(a){console.error(a),alert("Error happened: please see console")}}function N(){const r=document.createElement("div");r.className="drawing-board-control";const e=document.createElement("button");e.innerHTML="\u23EF",e.onclick=S,r.append(e);const w=document.querySelector(".drawing-board-controls");w&&(w.appendChild(r),M=!0,w.onclick=()=>{s&&clearInterval(s)})}Z(()=>{f=new window.DrawingBoard.Board("board-container",{size:10,controls:["Color",{Size:{type:"dropdown"}},{DrawingMode:{filler:!1}},"Navigation"]}).canvas,n=f.getContext("2d")});function q(){g=this.value,d(0,g)}return[g,i,y,q]}class re extends K{constructor(m){super(),$(this,m,ne,te,G,{})}}export{re as default};
