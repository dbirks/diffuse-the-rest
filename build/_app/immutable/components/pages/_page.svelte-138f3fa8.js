import{S as Q,i as X,s as Z,k as _,a as L,q as U,H as $,l as y,m as S,h as u,c as O,r as V,n as i,I as H,F as m,b as J,J as K,K as W,A as Y,L as ee,o as te,z as ae,M as ne,N as se}from"../../chunks/index-3db9fbe0.js";const{document:z}=ne;function re(I){let x,l,E,h,P,g,s,c,w,q,r,a,v,b,D,B,T,j,A,k,t,n;return{c(){x=_("link"),l=_("script"),h=_("script"),g=L(),s=_("div"),c=_("div"),w=_("div"),q=L(),r=_("div"),a=_("input"),v=L(),b=_("button"),D=U("diffuse the f rest"),T=L(),j=_("p"),A=U("pro tip: upload img by dropping on the canvas"),this.h()},l(e){const o=$('[data-svelte="svelte-18yikln"]',z.head);x=y(o,"LINK",{href:!0,rel:!0}),l=y(o,"SCRIPT",{src:!0});var d=S(l);d.forEach(u),h=y(o,"SCRIPT",{src:!0});var C=S(h);C.forEach(u),o.forEach(u),g=O(e),s=y(e,"DIV",{class:!0});var f=S(s);c=y(f,"DIV",{class:!0});var p=S(c);w=y(p,"DIV",{id:!0}),S(w).forEach(u),q=O(p),r=y(p,"DIV",{class:!0});var N=S(r);a=y(N,"INPUT",{type:!0,class:!0,placeholder:!0}),v=O(N),b=y(N,"BUTTON",{class:!0});var M=S(b);D=V(M,"diffuse the f rest"),M.forEach(u),N.forEach(u),T=O(p),j=y(p,"P",{class:!0});var F=S(j);A=V(F,"pro tip: upload img by dropping on the canvas"),F.forEach(u),p.forEach(u),f.forEach(u),this.h()},h(){i(x,"href","https://cdnjs.cloudflare.com/ajax/libs/drawingboard.js/0.4.2/drawingboard.css"),i(x,"rel","stylesheet"),H(l.src,E="https://code.jquery.com/jquery-1.12.4.min.js")||i(l,"src",E),H(h.src,P="https://cdnjs.cloudflare.com/ajax/libs/drawingboard.js/0.4.2/drawingboard.min.js")||i(h,"src",P),i(w,"id","board-container"),i(a,"type","text"),i(a,"class","border-2 "),i(a,"placeholder","Add prompt"),i(b,"class","bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4"),i(r,"class",B="flex gap-x-2 mt-4 items-center justify-center "+(I[1]?"animate-pulse":"")),i(j,"class","mt-2 opacity-50"),i(c,"class",k="flex flex-col items-center "+(I[1]?"pointer-events-none":"")),i(s,"class","flex flex-wrap gap-x-8 justify-center mt-8")},m(e,o){m(z.head,x),m(z.head,l),m(z.head,h),J(e,g,o),J(e,s,o),m(s,c),m(c,w),I[4](w),m(c,q),m(c,r),m(r,a),K(a,I[0]),m(r,v),m(r,b),m(b,D),m(c,T),m(c,j),m(j,A),t||(n=[W(a,"input",I[5]),W(b,"click",I[3])],t=!0)},p(e,[o]){o&1&&a.value!==e[0]&&K(a,e[0]),o&2&&B!==(B="flex gap-x-2 mt-4 items-center justify-center "+(e[1]?"animate-pulse":""))&&i(r,"class",B),o&2&&k!==(k="flex flex-col items-center "+(e[1]?"pointer-events-none":""))&&i(c,"class",k)},i:Y,o:Y,d(e){u(x),u(l),u(h),e&&u(g),e&&u(s),I[4](null),t=!1,ee(n)}}}const R=500,G=3e3;function oe(I,x,l){let E="",h=!1,P=!1,g,s,c,w,q,r,a=512,v;async function b(){if(!s)return;const t=s.createImageData(g.width,g.height),n=t.data;for(let d=0,C=n.length;d<C;d+=4)n[d]=40*Math.random()*7,n[d+1]=40*Math.random()*7,n[d+2]=40*Math.random()*7,n[d+3]=255;const e=await createImageBitmap(t),o=performance.now()-c;s.globalAlpha=Math.min(o,G)/G,s.drawImage(e,0,0,a,a),h&&window.requestAnimationFrame(b)}function D(t){if(!s)return;const n=performance.now()-w;s.globalAlpha=Math.min(n,R)/R,s.drawImage(t,0,0,a,a),n<R&&window.requestAnimationFrame(()=>D(t))}async function B(t){const n=t.toDataURL("png"),o=await(await fetch(n)).blob(),d=new File([o],"canvas shot.png",{type:"image/png"}),C=t.getContext("2d").getImageData(0,0,a,a),f=await createImageBitmap(C);return{imgFile:d,imgBitmap:f}}async function T(){if(!E)return alert("Please add prompt");if(!g||!s)return;l(1,h=!0),c=performance.now(),b();const{imgFile:t,imgBitmap:n}=await B(g),e=new FormData;e.append("prompt",E),e.append("image",t);const o=await fetch("https://sdb.pcuenca.net/i2i",{method:"POST",body:e});try{const d=JSON.parse(await o.text()),{images:C}=d,f=await Promise.all(C.map(async N=>{const M=new Image;return M.src=`data:image/png;base64, ${N}`,await new Promise((F,ie)=>{M.onload=()=>F(M)}),M}));f.push(n),l(1,h=!1),r&&clearInterval(r);let p=0;w=performance.now(),D(f[p%f.length]),q=()=>{r&&clearInterval(r),w=performance.now(),p=p+1,D(f[p%f.length])},r=setInterval(()=>{p=p+1,w=performance.now(),D(f[p%f.length])},2500),P||j()}catch(d){console.error(d),alert("Error happened: please see console")}}function j(){const t=document.createElement("div");t.className="drawing-board-control";const n=document.createElement("button");n.innerHTML="\u23EF",n.onclick=q,t.append(n);const e=document.querySelector(".drawing-board-controls");e&&(e.appendChild(t),P=!0,e.onclick=()=>{r&&clearInterval(r)})}te(async()=>{const{innerWidth:t}=window;a=Math.min(a,Math.floor(t*.75)),l(2,v.style.width=`${a}px`,v),l(2,v.style.height=`${a}px`,v),await ae(),g=new window.DrawingBoard.Board("board-container",{size:15,controls:["Color",{Size:{type:"dropdown"}},{DrawingMode:{filler:!1}}],droppable:!0,webStorage:!1,enlargeYourContainer:!0}).canvas,s=g.getContext("2d")});function A(t){se[t?"unshift":"push"](()=>{v=t,l(2,v)})}function k(){E=this.value,l(0,E)}return[E,h,v,T,A,k]}class ce extends Q{constructor(x){super(),X(this,x,oe,re,Z,{})}}export{ce as default};
