import{S as K,i as $,s as G,k as x,a as B,q as Q,H as W,l as j,m as E,h as c,c as k,r as X,n as o,I as O,p as R,F as h,b as U,J as V,K as z,A as H,L as Y,o as Z,M as ee}from"../../chunks/index-3def1fb1.js";const{document:F}=ee;function te(v){let m,d,_,i,M,f,a,u,p,S,r,l,D,b,N,q,n,e,y;return{c(){m=x("link"),d=x("script"),i=x("script"),f=B(),a=x("div"),u=x("div"),p=x("div"),S=B(),r=x("div"),l=x("input"),D=B(),b=x("button"),N=Q("diffuse the f rest"),this.h()},l(s){const t=W('[data-svelte="svelte-18yikln"]',F.head);m=j(t,"LINK",{href:!0,rel:!0}),d=j(t,"SCRIPT",{src:!0});var g=E(d);g.forEach(c),i=j(t,"SCRIPT",{src:!0});var w=E(i);w.forEach(c),t.forEach(c),f=k(s),a=j(s,"DIV",{class:!0});var T=E(a);u=j(T,"DIV",{class:!0});var I=E(u);p=j(I,"DIV",{id:!0,style:!0}),E(p).forEach(c),S=k(I),r=j(I,"DIV",{class:!0});var C=E(r);l=j(C,"INPUT",{type:!0,class:!0,placeholder:!0}),D=k(C),b=j(C,"BUTTON",{class:!0});var A=E(b);N=X(A,"diffuse the f rest"),A.forEach(c),C.forEach(c),I.forEach(c),T.forEach(c),this.h()},h(){o(m,"href","https://cdnjs.cloudflare.com/ajax/libs/drawingboard.js/0.4.2/drawingboard.css"),o(m,"rel","stylesheet"),O(d.src,_="https://code.jquery.com/jquery-1.12.4.min.js")||o(d,"src",_),O(i.src,M="https://cdnjs.cloudflare.com/ajax/libs/drawingboard.js/0.4.2/drawingboard.min.js")||o(i,"src",M),o(p,"id","board-container"),R(p,"width","512px"),R(p,"height","545px"),o(l,"type","text"),o(l,"class","border-2 "),o(l,"placeholder","Add prompt"),o(b,"class","bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4"),o(r,"class",q="flex gap-x-2 mt-4 items-center justify-center "+(v[1]?"animate-pulse":"")),o(u,"class",n=v[1]?"pointer-events-none":""),o(a,"class","flex flex-wrap gap-x-8 justify-center mt-16")},m(s,t){h(F.head,m),h(F.head,d),h(F.head,i),U(s,f,t),U(s,a,t),h(a,u),h(u,p),h(u,S),h(u,r),h(r,l),V(l,v[0]),h(r,D),h(r,b),h(b,N),e||(y=[z(l,"input",v[3]),z(b,"click",v[2])],e=!0)},p(s,[t]){t&1&&l.value!==s[0]&&V(l,s[0]),t&2&&q!==(q="flex gap-x-2 mt-4 items-center justify-center "+(s[1]?"animate-pulse":""))&&o(r,"class",q),t&2&&n!==(n=s[1]?"pointer-events-none":"")&&o(u,"class",n)},i:H,o:H,d(s){c(m),c(d),c(i),s&&c(f),s&&c(a),e=!1,Y(y)}}}const L=500,J=3e3,P=512;async function ae(v){const m=v.toDataURL("png"),_=await(await fetch(m)).blob();return new File([_],"canvas shot.png",{type:"image/png"})}function ne(v,m,d){let _="",i=!1,M=!1,f,a,u,p,S,r;async function l(){if(!a)return;const n=a.createImageData(f.width,f.height),e=n.data;for(let t=0,g=e.length;t<g;t+=4)e[t]=40*Math.random()*7,e[t+1]=40*Math.random()*7,e[t+2]=40*Math.random()*7,e[t+3]=255;const y=await createImageBitmap(n),s=performance.now()-u;a.globalAlpha=Math.min(s,J)/J,a.drawImage(y,0,0,P,P),i&&window.requestAnimationFrame(l)}function D(n){if(!a)return;const e=performance.now()-p;a.globalAlpha=Math.min(e,L)/L,a.drawImage(n,0,0,P,P),e<L&&window.requestAnimationFrame(()=>D(n))}async function b(){if(!_)return alert("Please add prompt");if(!f||!a)return;d(1,i=!0),u=performance.now(),l();const n=await ae(f),e=new FormData;e.append("prompt","owl"),e.append("image",n);const y=await fetch("https://sdb.pcuenca.net/i2i",{method:"POST",body:e}),s=JSON.parse(await y.text()),{images:t}=s,g=await Promise.all(t.map(async T=>{const I=new Image;return I.src=`data:image/png;base64, ${T}`,await new Promise((C,A)=>{I.onload=()=>C(I)}),I}));d(1,i=!1),r&&clearInterval(r);let w=0;p=performance.now(),D(g[w%g.length]),S=()=>{r&&clearInterval(r),p=performance.now(),w=w+1,D(g[w%g.length])},r=setInterval(()=>{w=w+1,p=performance.now(),D(g[w%g.length])},2500),M||N()}function N(){const n=document.createElement("div");n.className="drawing-board-control";const e=document.createElement("button");e.innerHTML="\u23EF",e.onclick=S,n.append(e);const y=document.querySelector(".drawing-board-controls");y&&(y.appendChild(n),M=!0)}Z(()=>{f=new window.DrawingBoard.Board("board-container",{size:10,controls:["Color",{Size:{type:"dropdown"}},{DrawingMode:{filler:!1}},"Navigation"]}).canvas,a=f.getContext("2d")});function q(){_=this.value,d(0,_)}return[_,i,b,q]}class re extends K{constructor(m){super(),$(this,m,ne,te,G,{})}}export{re as default};
